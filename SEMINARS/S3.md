## US-001 - Регистрация пользователя

* **Роль-Цель-Ценность:** Как гость, я хочу зарегистрировать учётную запись, чтобы получить доступ к функционалу приложения.
* **Кратко:** Регистрация с подтверждением e-mail.
* **API/Endpoints (пример):** `POST /api/auth/register`, `POST /api/auth/verify-email`
* **NFR hooks:** `Security-AuthN`, `InputValidation`, `RateLimiting`, `API-Contract/Errors`, `Privacy/PII`



## Таблица реестра

| ID      | User Story / Feature      | Category                 | Requirement (NFR)                                                                                   | Rationale / Risk                      | Acceptance (G-W-T)                                                                                                                 | Evidence (test/log/scan/policy)               | Trace (issue/link) | Owner     | Status | Priority    | Severity   | Tags                        |
|---------| ------------------------- | ------------------------ |-----------------------------------------------------------------------------------------------------|---------------------------------------|------------------------------------------------------------------------------------------------------------------------------------| --------------------------------------------- | ------------------ |-----------|--------| ----------- | ---------- |-----------------------------|
| NFR-001 | Регистрация пользователя | Rate Limiting / Throttling| На <POST /api/auth/verify-email> действует лимит 3/min на IP адресс; превышение → 429 + Retry-After | Защита от DDoS | **Given** ip адрес <br>**When** выполняется limit+N запросов к <endpoint> за 60 секунд <br>**Then** лишние запросы получают 429 и корректный заголовок Retry-After | e2e-тест лимита; логи с 429 и `Retry-After` | #123               | DevSecOps | Proposed   | P1 - High | S2 - Major | инфраструкура, безопасность |
| NFR-002 | Регистрация пользователя | Security-InputValidation | Для `POST /api/auth/register`: размер тела ≤ **64 KiB**, `Content-Type=application/json`, разрешены только поля `{email, password}`; **extra** поля → **400**; тело >64 KiB → **413**. | Защита от DoS/грязных данных                  | **Given** тело запроса размером 128 KiB **When** `POST /api/auth/register` **Then** ответ **413** с телом в RFC 7807;<br>**Given** тело с незадекларированным полем `debug` **When** `POST /api/auth/register` **Then** **400** в RFC 7807; схема DTO отклоняет неизвестные поля.                                                      | e2e: валидатор DTO; контракт-схема; логи 400/413        | #125               | Backend   | Draft    | P1 - High | S2 - Major | security,input,validation         |
| NFR-003 | Регистрация пользователя | API-Contract/Errors      | Ошибки для `POST /api/auth/register` и `POST /api/auth/verify-email` отдаются в формате **RFC 7807** (`application/problem+json`) без стэктрейсов; включён `correlation_id`.           | Предсказуемость API, отсутствие утечек        | **Given** серверная ошибка при `POST /api/auth/register` **When** клиент получает ответ **Then** `Content-Type=application/problem+json`, присутствуют `type/title/status/detail`, нет стэктрейсов, есть `correlation_id`;<br>**Given** бизнес-ошибка в `POST /api/auth/verify-email` **Then** тело также соответствует RFC 7807.      | контракт-тесты ошибок; пример problem+json в e2e        | #126               | Backend    | Proposed | P1 - High | S2 - Major | api-contract,errors,observability |
| NFR-004 | Регистрация пользователя | Privacy/PII              | PII (e-mail, IP, verification token) **не логируются**; сырые PII и незавершённые регистрации хранятся не дольше **30 дней** (ретенция/удаление по расписанию).                        | Приватность/комплаенс, снижение рисков утечки | **Given** DTO с `email` и `ip` **When** выполняется логирование на любом уровне **Then** поля PII замаскированы/отсутствуют;<br>**Given** учётная запись осталась неподтверждённой **When** проходит 30 дней **Then** запись и связанный verification-токен удаляются согласно политике ретенции; наличие задания ретенции проверяемо. | пример логов с маскировкой; регламент ретенции; job лог | #127               | DevSecOps | Proposed | P1 - High | S2 - Major | privacy,pii,compliance,retention  |

> Продолжайте ниже добавлять строки до достижения **8-10 NFR** (или больше, если нужно):




## US-002 - Вход в систему (Login)

* **Роль-Цель-Ценность:** Как пользователь, я хочу входить в систему по логину/паролю, чтобы управлять своими данными.
* **Кратко:** Вход, выдача JWT/сессии, защита от перебора.
* **API/Endpoints:** `POST /api/auth/login`
* **NFR hooks:** `Security-AuthN`, `RateLimiting`, `Timeouts/Retry`, `Observability/Logging`




## US-013 - Импорт CSV

* **Роль-Цель-Ценность:** Как менеджер, я хочу загружать CSV с данными, чтобы быстро обновлять систему.
* **Кратко:** Валидация схемы/размера, фоновые задания.
* **API/Endpoints:** `POST /api/import/csv`
* **NFR hooks:** `InputValidation`, `Data-Integrity`, `Scalability`, `Observability/Logging`


## Поля реестра (data dictionary)

* **ID** - короткий идентификатор, например `NFR-001`.
* **User Story / Feature** - к какой истории/фиче относится требование (ссылка допустима).
* **Category** - выберите из банка (напр.: `Performance`, `Security-AuthZ/RBAC`, `RateLimiting`, `Privacy/PII`, `Observability/Logging`, …).
* **Requirement (NFR)** - *измеримое* требование (числа/пороги/границы действия).
* **Rationale / Risk** - зачем это нужно, какой риск/ценность покрываем.
* **Acceptance (G-W-T)** - проверяемая формулировка: *Given … When … Then …*.
* **Evidence (test/log/scan/policy)** - чем подтвердим выполнение (тест, лог-шаблон, сканер, политика).
* **Trace (issue/link)** - ссылка на задачу, обсуждение, артефакт.
* **Owner** - ответственный.
* **Status** - `Draft` | `Proposed` | `Approved` | `Implemented` | `Verified`.
* **Priority** - `P1 - High` | `P2 - Medium` | `P3 - Low`.
* **Severity** - `S1 - Critical` | `S2 - Major` | `S3 - Minor`.
* **Tags** - произвольные метки (через запятую).

---

## Таблица реестра

| ID      | User Story / Feature      | Category                 | Requirement (NFR)                                                   | Rationale / Risk                     | Acceptance (G-W-T)                                                                                                    | Evidence (test/log/scan/policy)               | Trace (issue/link) | Owner  | Status   | Priority    | Severity   | Tags              |
| ------- | ------------------------- | ------------------------ | ------------------------------------------------------------------- | ------------------------------------ | --------------------------------------------------------------------------------------------------------------------- | --------------------------------------------- | ------------------ | ------ | -------- | ----------- | ---------- | ----------------- |
| NFR-001 | As a user I upload avatar | Security-InputValidation | Reject payloads >1 MiB; MIME из allowlist; **extra** поля запрещены | Защита от DoS/грязных входных данных | **Given** тело 2 MiB и неизвестные поля<br>**When** POST `/api/files/avatar`<br>**Then** 413 с RFC7807 + запрет extra | test: `e2e-upload-limit`; policy: schema/size | #123               | team-a | Proposed | P2 - Medium | S2 - Major | limits,validation |
| NFR-002 | As a client I call /api/* | Performance              | P95 ≤ 300 ms при 50 RPS в течение 5 мин                             | UX/SLO                               | **Given** сервис здоров<br>**When** 50 RPS на `/api/*` 5 минут<br>**Then** P95 ≤ 300 ms; error rate ≤ 1%              | test: `load-50rps`; log: latency quantiles    | #124               | team-a | Draft    | P1 - High   | S2 - Major | perf,slo          |

> Продолжайте ниже добавлять строки до достижения **8-10 NFR** (или больше, если нужно):

| ID | User Story / Feature | Category | Requirement (NFR) | Rationale / Risk | Acceptance (G-W-T) | Evidence (test/log/scan/policy) | Trace (issue/link) | Owner | Status | Priority    | Severity   | Tags |
| -- | -------------------- | -------- | ----------------- | ---------------- | ------------------ | ------------------------------- | ------------------ | ----- | ------ | ----------- | ---------- | ---- |
|    |                      |          |                   |                  |                    |                                 |                    |       | Draft  | P2 - Medium | S2 - Major |      |
|    |                      |          |                   |                  |                    |                                 |                    |       | Draft  | P2 - Medium | S2 - Major |      |
|    |                      |          |                   |                  |                    |                                 |                    |       | Draft  | P2 - Medium | S2 - Major |      |
|    |                      |          |                   |                  |                    |                                 |                    |       | Draft  | P2 - Medium | S2 - Major |      |
|    |                      |          |                   |                  |                    |                                 |                    |       | Draft  | P2 - Medium | S2 - Major |      |
|    |                      |          |                   |                  |                    |                                 |                    |       | Draft  | P2 - Medium | S2 - Major |      |
|    |                      |          |                   |                  |                    |                                 |                    |       | Draft  | P2 - Medium | S2 - Major |      |
|    |                      |          |                   |                  |                    |                                 |                    |       | Draft  | P2 - Medium | S2 - Major |      |
